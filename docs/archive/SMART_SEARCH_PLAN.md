# 智能全局搜索中心实现方案 (Smart Search Center)

本文档旨在规划将现有的全局搜索框升级为类 Notion 的“智能命令中心”。通过整合本地数据（收藏、历史）与实时反馈，提升用户发现与检索音乐的效率。

---

## 1. 核心设计理念

*   **即时触达 (Instant Access)**：在用户完成输入前，优先匹配已有的本地资产。
*   **空间优化 (Spatial Efficiency)**：采用下拉建议列表，默认仅展示高频项，通过链接引导深入探索。
*   **Notion 交互规范**：无边框感、轻量级阴影、背景色反馈、快捷键友好。

---

## 2. 功能逻辑

### A. 触发机制
*   **实时搜索**：输入字符即刻触发本地数据（收藏 & 历史）的模糊匹配。
*   **回车确认**：执行全库（云端）深度搜索，并跳转至搜索结果页。

### B. 下拉建议结构
1.  **收藏中 (Favorites)**
    *   显示匹配度最高的前 3-5 首歌曲。
    *   底部显示：`还有 X 首收藏 →`，点击后跳转至收藏页并自动填入该搜索词。
2.  **历史记录 (History)**
    *   显示匹配度最高的前 3-5 首歌曲。
    *   底部显示：`还有 X 首历史 →`，点击后跳转至历史页并自动填入该搜索词。
3.  **全局操作**
    *   底部固定项：`按回车键搜索全部歌曲...`。

---

## 3. 分阶段实现步骤

### 第一阶段：底层数据检索层封装
*   **任务**：封装一个统一的本地搜索服务。
*   **要点**：
    *   从 `localStorage` 读取 `favorites` 和 `history` 数据。
    *   引入模糊搜索逻辑（支持拼音、部分匹配）。
    *   定义统一的结果对象格式。

### 第二阶段：UI 架构与 Popover 实现
*   **任务**：实现跟随搜索框的下拉悬浮层。
*   **要点**：
    *   处理 `z-index` 确保浮层不被内容区遮挡。
    *   实现 Notion 风格样式：背景 `#FFFFFF`，阴影 `0 4px 12px rgba(0,0,0,0.1)`，圆角 `8px`。
    *   响应式适配：移动端全屏宽度，桌面端固定最大宽度。

### 第三阶段：实时匹配与数据驱动
*   **任务**：将输入框状态与本地搜索逻辑挂钩。
*   **要点**：
    *   实现 `150ms` 的防抖 (Debounce) 逻辑。
    *   当输入框获得焦点 (Focus) 且有内容时显示浮层。
    *   处理空状态（未匹配到本地数据时的提示）。

### 第四阶段：交互强化与路由联动
*   **任务**：实现键盘导航与跳转筛选。
*   **要点**：
    *   支持 `↑` `↓` 键切换高亮项，`Enter` 键播放选中歌曲。
    *   **核心功能**：实现“查看更多”链接。点击后，通过 `onTabChange` 跳转页面，并向目标页面传递 `searchQuery` 参数，让收藏/历史页进入“筛选模式”。

### 第五阶段：性能优化与细节打磨
*   **任务**：提升丝滑感。
*   **要点**：
    *   优化大数据量下的匹配速度。
    *   添加轻微的淡入淡出动画。
    *   确保移动端点击建议项后，键盘能自动收起。

---

## 4. 关键技术点预研

*   **数据源**：`src/services/storage.js` 中的 `getFavorites()` 和 `getHistory()`。
*   **筛选参数传递**：由于当前使用自定义状态路由，需在 `App.js` 的 `handleTabChange` 中增加可选的 `initialSearch` 参数。
*   **Notion 样式同步**：复用 `theme.css` 中的 `--color-hover-notion`。
